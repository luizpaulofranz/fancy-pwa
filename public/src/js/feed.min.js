function initializeLocation(){"geolocation"in navigator||(locationBtn.style.display="none")}function initializeMediaPicker(){"mediaDevicer"in navigator||(navigator.mediaDevices={}),"getUserMedia"in navigator.mediaDevices||(navigator.mediaDevices.getUserMedia=function(e){let t=navigator.webkitGetUserMedia||navigator.mozGetUserMedia;return t?new Promise((n,o)=>{t.call(navigator,e,n,o)}):Promise.reject(new Error("getUserMedia is not implemented by your browser!"))}),navigator.mediaDevices.getUserMedia({video:!0}).then(e=>{videoPlayer.srcObject=e,videoPlayer.style.display="block"}).catch(e=>{imagePickerArea.style.display="block"})}function openCreatePostModal(){setTimeout(function(){createPostArea.style.transform="translateY(0)"},1e3),initializeMediaPicker(),initializeLocation(),deferredPrompt&&(deferredPrompt.prompt(),deferredPrompt.userChoice.then(e=>{console.log(e.outcome),"dismiss"===e.outcome?console.log("User cancel installation"):console.log("User ADD into home screen!"),deferredPrompt=null}))}function closeCreatePostModal(){videoPlayer.style.display="none",imagePickerArea.style.display="none",canvasElement.style.display="none",locationLoader.style.display="none",locationBtn.style.display="inline",captureButton.style.display="inline",null!=videoPlayer.srcObject&&videoPlayer.srcObject.getVideoTracks().forEach(function(e){e.stop()}),setTimeout(function(){createPostArea.style.transform="translateY(100vh)"},1e3)}function onSaveButtonClick(e){console.log("Store cache on demand!"),"caches"in window&&caches.open("user-on-demand-cache").then(e=>{e.add("https://httpbin.org/get"),e.add("/src/images/sf-boat.jpg")})}function clearCards(){for(;sharedMomentsArea.hasChildNodes();)sharedMomentsArea.removeChild(sharedMomentsArea.lastChild)}function createCard(e){var t=document.createElement("div");t.className="shared-moment-card mdl-card mdl-shadow--2dp";var n=document.createElement("div");n.className="mdl-card__title",n.style.backgroundImage=`url("${e.image}")`,n.style.backgroundSize="cover",n.style.height="180px",n.style.color="white",t.appendChild(n);var o=document.createElement("h2");o.className="mdl-card__title-text",o.textContent=e.title,n.appendChild(o);var a=document.createElement("div");a.className="mdl-card__supporting-text",a.textContent=e.location,a.style.textAlign="center",t.appendChild(a),componentHandler.upgradeElement(t),sharedMomentsArea.appendChild(t)}function updateUi(e){clearCards();for(let t of e)createCard(t)}function firebaseReturnHelper(e){let t=[];for(let n in e)t.push(e[n]);return t}function sendData(){let e=new FormData,t=(new Date).toISOString();e.append("title",titleInput.value),e.append("location",locationInput.value),e.append("rawLocationLat",fetchedLocation.lat),e.append("rawLocationLng",fetchedLocation.lng),e.append("file",picture,t+".png"),e.append("id",t),fetch("https://us-central1-fancy-pwagram.cloudfunctions.net/storePostsData",{method:"POST",body:e}).then(e=>{updateUi()})}var shareImageButton=document.querySelector("#share-image-button"),createPostArea=document.querySelector("#create-post"),closeCreatePostModalButton=document.querySelector("#close-create-post-modal-btn"),sharedMomentsArea=document.querySelector("#shared-moments"),form=document.querySelector("form");let picture,titleInput=document.querySelector("#title"),videoPlayer=document.querySelector("#player"),canvasElement=document.querySelector("#canvas"),captureButton=document.querySelector("#capture-btn"),imagePicker=document.querySelector("#image-picker"),imagePickerArea=document.querySelector("#pick-image"),locationBtn=document.querySelector("#location-btn"),locationLoader=document.querySelector("#location-loader"),locationInput=document.querySelector("#location"),fetchedLocation={lat:0,lng:0};locationBtn.addEventListener("click",()=>{if("geolocation"in navigator){let e=!1;locationBtn.style.display="none",locationLoader.style.display="inline",navigator.geolocation.getCurrentPosition(e=>{locationBtn.style.display="inline",locationLoader.style.display="none",fetchedLocation={lat:e.coords.latitude,lng:0},locationInput.value="Any Where",document.querySelector("#manual-location").classList.add("is-focused")},t=>{console.log("Error on getCurrentPosition. ",t),e||(alert("We could'nt find a location, please enter manually."),e=!0),fetchedLocation={lat:0,lng:0},locationBtn.style.display="inline",locationLoader.style.display="none"},{timeout:7e3})}}),captureButton.addEventListener("click",e=>{canvasElement.style.display="block",videoPlayer.style.display="none",captureButton.style.display="none",canvasElement.getContext("2d").drawImage(videoPlayer,0,0,canvas.width,videoPlayer.videoHeight/(videoPlayer.videoWidth/canvas.width)),videoPlayer.srcObject.getVideoTracks().forEach(function(e){e.stop()}),picture=dataURItoBlob(canvasElement.toDataURL())}),imagePicker.addEventListener("change",function(e){picture=e.target.files[0]}),shareImageButton.addEventListener("click",openCreatePostModal),closeCreatePostModalButton.addEventListener("click",closeCreatePostModal);const url="https://fancy-pwagram.firebaseio.com/posts.json";let networkDataReceived=!1;fetch(url).then(function(e){return e.json()}).then(function(e){networkDataReceived=!0,updateUi(firebaseReturnHelper(e))}),"indexedDB"in window&&readAll("posts").then(e=>{networkDataReceived||updateUi(e)}),form.addEventListener("submit",e=>{if(e.preventDefault(),""==titleInput.value.trim()||""==locationInput.value.trim())return void alert("Please enter valid data!");closeCreatePostModal(),"serviceWorker"in navigator&&"SyncManager"in window?navigator.serviceWorker.ready.then(e=>{let t={id:(new Date).toString(),title:titleInput.value,location:locationInput.value,picture:picture,rawLocation:fetchedLocation};writeData("sync-posts",t).then(()=>{return e.sync.register("sync-new-posts")}).then(()=>{let e=document.querySelector("#confirmation-toast"),t={message:"Your post was saved for syncing."};e.MaterialSnackbar.showSnackbar(t)}).catch(e=>{console.log(e)})}):sendData()});